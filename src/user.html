<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   Account Page
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
 </head>
 <body class="bg-gray-100">
  <header class="bg-yellow-400 p-4 flex items-center justify-between">
   <div class="flex items-center">
    <a href="/PaginaPrincipal.html">
     <img alt="Mercado Libre logo" class="h-8" height="50" src="https://storage.googleapis.com/a1aa/image/MVCAAN9afgE02O1wMzUc_N0JaMEX4utZDiVx4Oy0tu4.jpg" width="50"/>
    </a>
    <div class="ml-4">
     <p class="text-sm">
      Enviar a Juan
     </p>
    </div>
   </div>
   <div class="flex-1 mx-4">
    <input class="w-full p-2 rounded border border-gray-300" placeholder="Buscar productos, marcas y más..." type="text"/>
   </div>
   <div class="flex items-center space-x-4">
    <a class="text-sm" href="/GestionProductos.html">
     Categorías
    </a>
    <a class="text-sm" href="#">
     Ayuda
    </a>
    <div class="relative">
     <img alt="User avatar" class="h-8 w-8 rounded-full" height="30" src="https://storage.googleapis.com/a1aa/image/JWtIfhlKRM-OkP4V62ufjvv9suro06qYJmK4vRgo8bI.jpg" width="30"/>
     <span class="absolute bottom-0 right-0 bg-green-500 h-2 w-2 rounded-full">
     </span>
    </div>
    <a class="text-sm" href="#">
     Juan David
    </a>
    <a class="text-sm" href="#">
     Mis compras
    </a>
    <a class="text-sm" href="/logout">
     Cerrar sesión
    </a>
    <i class="fas fa-shopping-cart text-lg" onclick="window.location.href='/carrito'">
    </i>
   </div>
  </header>
  <main class="flex">
   <aside class="w-1/4 bg-white p-4">
    <nav>
     <ul>
      <li class="mb-4">
       <a class="flex items-center text-gray-700" href="#">
        <i class="fas fa-shopping-cart mr-2">
        </i>
        Compras
       </a>
      </li>
      <li class="mb-4">
       <a class="flex items-center text-gray-700" href="#">
        <i class="fas fa-store mr-2">
        </i>
        Ventas
       </a>
      </li>
      <li class="mb-4">
       <a class="flex items-center text-gray-700" href="#">
        <i class="fas fa-bullhorn mr-2">
        </i>
        Marketing
       </a>
      </li>
      <li class="mb-4">
       <a class="flex items-center text-gray-700" href="#">
        <i class="fas fa-newspaper mr-2">
        </i>
        Suscripciones
       </a>
      </li>
      <li class="mb-4">
       <a class="flex items-center text-gray-700" href="#">
        <i class="fas fa-leaf mr-2">
        </i>
        Bio libre
       </a>
      </li>
      <li class="mb-4">
       <a class="flex items-center text-gray-700" href="#">
        <i class="fas fa-file-invoice mr-2">
        </i>
        Facturación
       </a>
      </li>
      <li class="mb-4">
       <a class="flex items-center text-gray-700" href="#">
        <i class="fas fa-user mr-2">
        </i>
        Mi perfil
       </a>
      </li>
      <li class="mb-4">
       <a class="flex items-center text-gray-700" href="#">
        <i class="fas fa-cog mr-2">
        </i>
        Configuración
       </a>
      </li>
     </ul>
    </nav>
   </aside>
   <section class="flex-1 p-8">
    <div class="bg-white p-6 rounded shadow">
     <div class="flex items-center mb-4">
      <img alt="User avatar" class="h-12 w-12 rounded-full" height="50" src="https://storage.googleapis.com/a1aa/image/JWtIfhlKRM-OkP4V62ufjvv9suro06qYJmK4vRgo8bI.jpg" width="50"/>
      <div class="ml-4">
       <h2 id="user-name" class="text-xl font-semibold">
        <!-- Nombre del usuario -->
       </h2>
       <p id="user-email" class="text-gray-600">
        <!-- Email del usuario -->
       </p>
       <a class="text-blue-500" href="#">
        Estás en nivel 1 - Mercado Puntos
       </a>
      </div>
     </div>
     <ul>
      <li class="flex items-center justify-between p-4 border-b cursor-pointer" onclick="toggleSection('personal-info')">
       <div class="flex items-center">
        <i class="fas fa-user text-blue-500 mr-2">
        </i>
        <div>
         <h3 class="font-semibold">
          Información personal
         </h3>
         <p class="text-gray-600">
          Información de tu documento de identidad y ocupación.
         </p>
        </div>
       </div>
       <i class="fas fa-chevron-right text-gray-600" id="personal-info-icon">
       </i>
      </li>
      <div class="hidden" id="personal-info">
       <form class="space-y-4 p-4" id="updateUserForm">
        <div>
         <label class="block text-sm font-medium text-gray-700" for="name">
          Nombre
         </label>
         <input class="block w-full p-2 border border-gray-300 rounded" id="name" name="name" required="" type="text"/>
        </div>
        <div>
         <label class="block text-sm font-medium text-gray-700" for="email">
          Correo Electrónico
         </label>
         <input class="block w-full p-2 border border-gray-300 rounded" id="email" name="email" required="" type="email"/>
        </div>
        <button class="w-full bg-blue-500 text-white p-2 rounded" type="submit">
         Actualizar Datos
        </button>
        <div class="text-red-500 text-sm mt-2 hidden" id="update-user-message">
        </div>
       </form>
       <form class="space-y-4 p-4 mt-6" id="updatePasswordForm">
        <div>
         <label class="block text-sm font-medium text-gray-700" for="currentPassword">
          Contraseña Actual
         </label>
         <input class="block w-full p-2 border border-gray-300 rounded" id="currentPassword" name="currentPassword" required="" type="password"/>
        </div>
        <div>
         <label class="block text-sm font-medium text-gray-700" for="newPassword">
          Nueva Contraseña
         </label>
         <input class="block w-full p-2 border border-gray-300 rounded" id="newPassword" name="newPassword" required="" type="password"/>
        </div>
        <button class="w-full bg-blue-500 text-white p-2 rounded" type="submit">
         Actualizar Contraseña
        </button>
        <div class="text-red-500 text-sm mt-2 hidden" id="update-password-message">
        </div>
       </form>
      </div>
      <li class="flex items-center justify-between p-4 border-b">
       <div class="flex items-center">
        <i class="fas fa-id-card text-blue-500 mr-2">
        </i>
        <div>
         <h3 class="font-semibold">
          Datos de tu cuenta
         </h3>
         <p class="text-gray-600">
          Datos que representan a la cuenta en Mercado Libre y Mercado Pago.
         </p>
        </div>
       </div>
       <i class="fas fa-chevron-right text-gray-600">
       </i>
      </li>
      <li class="flex items-center justify-between p-4 border-b">
       <div class="flex items-center">
        <i class="fas fa-shield-alt text-blue-500 mr-2">
        </i>
        <div>
         <h3 class="font-semibold">
          Seguridad
         </h3>
         <p class="text-gray-600">
          Tienes configurada la seguridad de tu cuenta.
         </p>
        </div>
       </div>
       <i class="fas fa-chevron-right text-gray-600">
       </i>
      </li>
      <li class="flex items-center justify-between p-4 border-b">
       <div class="flex items-center">
        <i class="fas fa-credit-card text-blue-500 mr-2">
        </i>
        <div>
         <h3 class="font-semibold">
          Tarjetas
         </h3>
         <p class="text-gray-600">
          Tarjetas guardadas en tu cuenta.
         </p>
        </div>
       </div>
       <i class="fas fa-chevron-right text-gray-600">
       </i>
      </li>
      <li class="flex items-center justify-between p-4 border-b">
       <div class="flex items-center">
        <i class="fas fa-map-marker-alt text-blue-500 mr-2">
        </i>
        <div>
         <h3 class="font-semibold">
          Direcciones
         </h3>
         <p class="text-gray-600">
          Direcciones guardadas en tu cuenta.
         </p>
        </div>
       </div>
       <i class="fas fa-chevron-right text-gray-600">
       </i>
      </li>
      <li class="flex items-center justify-between p-4 border-b">
       <div class="flex items-center">
        <i class="fas fa-user-shield text-blue-500 mr-2">
        </i>
        <div>
         <h3 class="font-semibold">
          Privacidad
         </h3>
         <p class="text-gray-600">
          Preferencias y control sobre el uso de tus datos.
         </p>
        </div>
       </div>
       <i class="fas fa-chevron-right text-gray-600">
       </i>
      </li>
      <li class="flex items-center justify-between p-4 border-b">
       <div class="flex items-center">
        <i class="fas fa-envelope text-blue-500 mr-2">
        </i>
        <div>
         <h3 class="font-semibold">
          Comunicaciones
         </h3>
         <p class="text-gray-600">
          Elige qué tipo de información quieres recibir.
         </p>
        </div>
       </div>
       <i class="fas fa-chevron-right text-gray-600">
       </i>
      </li>
     </ul>
     <p class="text-gray-600 mt-4">
      Puedes
      <a class="text-blue-500" href="#">
       cancelar tu cuenta
      </a>
      siempre que lo desees.
     </p>
    </div>
   </section>
   <script>
    async function loadUserData() {
        try {
            const response = await fetch('/user-data');
            if (!response.ok) {
                throw new Error("No autorizado");
            }
            const user = await response.json();
            document.getElementById('user-name').innerText = user.name;
            document.getElementById('user-email').innerText = user.email;
            document.getElementById('name').value = user.name;
            document.getElementById('email').value = user.email;
        } catch (error) {
            console.error("Error al cargar los datos del usuario:", error);
            window.location.href = '/login';
        }
    }

    function toggleSection(sectionId) {
        const section = document.getElementById(sectionId);
        const icon = document.getElementById(`${sectionId}-icon`);
        if (section.classList.contains('hidden')) {
            section.classList.remove('hidden');
            icon.classList.remove('fa-chevron-right');
            icon.classList.add('fa-chevron-down');
        } else {
            section.classList.add('hidden');
            icon.classList.remove('fa-chevron-down');
            icon.classList.add('fa-chevron-right');
        }
    }

    document.getElementById('updateUserForm').addEventListener('submit', async function (event) {
        event.preventDefault();
        const form = event.target;
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());

        try {
            const response = await fetch('/update-user', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            });

            if (!response.ok) {
                const message = await response.text();
                document.getElementById('update-user-message').innerText = message;
                document.getElementById('update-user-message').classList.remove('hidden');
            } else {
                document.getElementById('update-user-message').classList.add('hidden');
                alert('Datos actualizados correctamente');
                loadUserData();
            }
        } catch (error) {
            document.getElementById('update-user-message').innerText = 'Error al actualizar los datos';
            document.getElementById('update-user-message').classList.remove('hidden');
        }
    });

    document.getElementById('updatePasswordForm').addEventListener('submit', async function (event) {
        event.preventDefault();
        const form = event.target;
        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());

        try {
            const response = await fetch('/update-password', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(data),
            });

            if (!response.ok) {
                const message = await response.text();
                document.getElementById('update-password-message').innerText = message;
                document.getElementById('update-password-message').classList.remove('hidden');
            } else {
                document.getElementById('update-password-message').classList.add('hidden');
                alert('Contraseña actualizada correctamente');
                form.reset();
            }
        } catch (error) {
            document.getElementById('update-password-message').innerText = 'Error al actualizar la contraseña';
            document.getElementById('update-password-message').classList.remove('hidden');
        }
    });

    window.onload = loadUserData; // Llama a la función cuando se carga la página
</script>
  </main>
 </body>
</html>